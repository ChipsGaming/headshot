Оригинальная статья: [Fast paced multiplayer](http://www.gabrielgambetta.com/fast_paced_multiplayer.html).

# Проблемы мултиплеера
Основной проблемной в мультиплеерных играх является разница (latency) между действием пользователя и реакцией сервера на него, называемая задержкой. Для пользователя, играющего с высокой задержкой, игра выглядит менее отзывчивой и прерывистой.

![Простое клиент-серверное взаимодействие](http://www.gabrielgambetta.com/img/fpm1-01.png)

Но сетевая задержка является не единственной причиной снижения отзывчивости игры. Сразу после получения состояния мира клиентом ему еще необходимо его визуализировать (анимировать), что еще больше увеличивает время отклика на действия пользователя.

![Сетевая задержка + анимация](http://www.gabrielgambetta.com/img/fpm2-02.png)

Наиболее актуальна эта проблема при использовании модели _Авторитетного сервера_, требующая считать состояние игрового мира, хранящегося на сервера - эталонным. Клиенты в этой модели являются обычными зрителями, способными влиять на игровой мир пересылкой команд пользователя на сервер и ожидая отклика.

# Прогнозирование
Простейшим решением проблемы является _Прогнозирование_. Оно заключается в немедленной визуализации действий пользователя на клиенте, не дожидаясь реакции сервера.

![Прогнозирование](http://www.gabrielgambetta.com/img/fpm2-03.png)

Учитывая модель _Авторитетного сервера_, такое решение позволит снизить время отклика только в начале действия, но после получения состояния сервера объект игрового мира начнет дергаться.

![Проблемы прогнозирования](http://www.gabrielgambetta.com/img/fpm2-04.png)

# Согласование
Для сглаживания прерывистости, вызываемой _Прогнозированием_, можно применить механизм _Согласования_ состояния игрового мира клиента с сервером.

![Согласование](http://www.gabrielgambetta.com/img/fpm2-05.png)

Оно заключается в простом алгоритме:

1. Каждое действие пользователя маркируется, передается серверу и сохраняется в истории клиента
2. Сервер должен возвращать состояние игрового мира с маркировкой действия, вызвавшего изменения в нем
3. При получении состояния от сервера, клиент должен переместить объекты в соответствии с этим состоянием, а так же применить все сохраненные в истории действия, выполненные пользователем до этого состояния
